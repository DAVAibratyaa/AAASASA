{% extends "base.html" %}
{% block title %}Laudos.ai - Resultado{% endblock %}

{% block content %}
<div x-data="resultPage()" x-init="init()" class="max-w-7xl mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4 text-gray-200">Resultado do Laudo</h1>

  <!-- Main Flex Container: Left preview & Right editor -->
  <div class="flex flex-col md:flex-row gap-4">

    <!-- Left (Preview) -->
    <div class="flex-1 bg-gray-800 rounded p-4 space-y-2">
      <h2 class="text-lg font-semibold text-gray-100 mb-2">Preview</h2>
      <!-- 
        We show the laudo with spacing preserved. 
        'whitespace-pre-wrap' => retains line breaks/spaces 
      -->
      <div 
        id="previewBox"
        class="bg-gray-700 text-gray-100 rounded p-2 whitespace-pre-wrap overflow-y-auto h-64"
        x-text="laudoContent"
      ></div>

      <!-- Buttons: Copy from preview, Transfer to editor -->
      <div class="flex gap-2">
        <button
          @click="copyPreview()"
          class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded"
        >
          Copiar Preview
        </button>
        <button
          @click="transferToEditor()"
          class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded"
        >
          Transferir para Editor
        </button>
      </div>
    </div>

    <!-- Right (Editor) -->
    <div class="flex-1 bg-gray-800 rounded p-4 space-y-2">
      <h2 class="text-lg font-semibold text-gray-100 mb-2">Editor</h2>
      <textarea
        id="editorBox"
        x-model="editorContent"
        class="bg-gray-700 text-gray-100 rounded p-2 w-full h-64 whitespace-pre-wrap focus:outline-none focus:ring-2 focus:ring-blue-500"
      ></textarea>

      <!-- Buttons: Copy from editor -->
      <div class="flex gap-2">
        <button
          @click="copyEditor()"
          class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded"
        >
          Copiar Editor
        </button>
        <!-- Optional: If you want a "clear" or "save" or anything else -->
      </div>
    </div>
  </div>

  <!-- Notification Toast -->
  <div 
    x-show="showToast"
    x-transition
    class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-3 rounded shadow-lg"
    style="display: none;"
  >
    <span x-text="toastMsg"></span>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  function resultPage() {
    return {
      // The raw laudo from server, with spacing. 
      // If you want to remove any HTML tags, you can do so here in init().
      laudoContent: `{{ laudo|escape|replace("\n","\\n") }}`, 

      editorContent: '',
      showToast: false,
      toastMsg: '',

      init() {
        // If you want the editor to start with laudo content, do:
        // this.editorContent = this.lau{{ laudo|escape|replace("\n","\\n") }}
        // But for now, let's keep it empty until user transfers.
      },

      copyPreview() {
        // Copy exactly what's in 'laudoContent', including line breaks.
        navigator.clipboard.writeText(this.laudoContent.replace(/\\n/g, '\n'))
          .then(() => this.fireToast("Preview copiado!"))
          .catch(() => this.fireToast("Erro ao copiar preview."));
      },

      transferToEditor() {
        // Transfer entire text from preview to editor.
        this.editorContent = this.laudoContent.replace(/\\n/g, '\n');
        this.fireToast("ConteÃºdo transferido para editor!");
      },

      copyEditor() {
        // Copy text from the editor
        navigator.clipboard.writeText(this.editorContent)
          .then(() => this.fireToast("Editor copiado!"))
          .catch(() => this.fireToast("Erro ao copiar editor."));
      },

      fireToast(msg) {
        this.toastMsg = msg;
        this.showToast = true;
        setTimeout(() => { this.showToast = false; }, 3000);
      }
    }
  }
</script>
{% endblock %}
